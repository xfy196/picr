import{A as X,e as p,f as Z,g as x,s as H,o as c,c as f,w as a,V as J,a as t,B,b as h,h as M,F as L,i as U,z as u,t as _,W as Y,X as K,Y as P,G as Q,Z as ee,a0 as ae,a1 as te,a2 as le,a3 as oe,a4 as se,a5 as ne,a6 as ue,a7 as re}from"./vendor.31c85475.js";import{u as de,a as ie,b as ce}from"./index.1f9a8423.js";/* empty css              */import{_ as _e,u as ve}from"./index.fd66f169.js";const pe=u("\u786E\u8BA4Token"),fe={key:0},me=u("\u624B\u52A8\u521B\u5EFA\u4E00\u4E2A\u76EE\u5F55"),ge=u("\u5B58\u653E\u5728\u6839\u76EE\u5F55"),he=u("\u6839\u636E\u65E5\u671F\u81EA\u52A8\u521B\u5EFAYYYYMMDD\u683C\u5F0F"),ye=u("\u91CD\u7F6E"),De=u("\u5B8C\u6210\u914D\u7F6E"),ke={setup(Be){const i=ve(),{config:n,repos:q,branches:F}=X(i),R=p([]),y=p(!1),D=p(null),T=Z(),$=p({selectedRepos:[{required:!0,message:"\u8BF7\u9009\u62E9\u6587\u4EF6\u4E0A\u4F20\u7684\u4ED3\u5E93",trigger:"blur"}],selectedBranch:[{required:!0,message:"\u8BF7\u9009\u62E9\u4ED3\u5E93\u7684\u5206\u652F",trigger:"blur"}],selectedDir:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E0A\u4F20\u6587\u4EF6\u7684\u76EE\u5F55",trigger:"blur",type:"string"}],selectedDirList:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E0A\u4F20\u6587\u4EF6\u7684\u76EE\u5F55",trigger:"blur",type:"array"}]}),e=p({token:n.value.token,login:n.value.login,dirMode:n.value.dirMode,selectedDir:n.value.selectedDir,selectedRepos:n.value.selectedRepos,selectedBranch:n.value.selectedBranch,selectedDirList:n.value.selectedDirList}),v=p({1:"\u65B0\u5EFA\u76EE\u5F55",2:"\u6839\u76EE\u5F55",3:"\u81EA\u52A8\u76EE\u5F55",4:`\u9009\u62E9${n.value.selectedRepos}\u4ED3\u5E93\u76EE\u5F55`}),N=de(async()=>{y.value=!0,await i.getUser(e.value.token),e.value.token=n.value.token,e.value.login=n.value.login,await i.getRepos(),y.value=!1},1e3,!1),S=async()=>{try{await D.value.validate(),i.updateConfig({dirMode:e.value.dirMode,selectedDir:e.value.selectedDir,selectedRepos:e.value.selectedRepos,selectedBranch:e.value.selectedBranch,selectedDirList:e.value.selectedDirList}),T.push({path:"/upload"})}catch(s){console.log(s)}},V=()=>{D.value.resetFields(),i.logout()},I=()=>{e.value.dirMode===2?e.value.selectedDir="/":e.value.dirMode===3?e.value.selectedDir=ie(ce(),"YYYYMMDD").value:e.value.dirMode===1?e.value.selectedDir="xxx":e.value.dirMode===4&&(e.value.selectedDirList=[])},j=async s=>{const l=s[s.length-1];l.loading=!0;let d=await i.getBranchCatalogue({repo:e.value.selectedRepos,dir:e.value.selectedDirList.join("/"),query:{ref:e.value.selectedBranch}});l.loading=!1;let r=b(d);if(r.length===0){l.isLeaf=!0;return}l.children=r},b=s=>s.filter(l=>l.type==="dir").map(l=>{let d={};return d.label=l.name,d.value=l.name,d.isLeaf=!1,d});return x(()=>e.value.selectedBranch,async s=>{if(e.value.selectedDirList=[],s.trim()){let l=await i.getBranchCatalogue({repo:e.value.selectedRepos,dir:"",query:{ref:s}});R.value=b(l)}},{immediate:!0}),x(()=>e.value.selectedRepos,async s=>{s.trim()&&(n.value.selectedRepos!==s&&(e.value.selectedBranch=""),await i.getBranches(s))},{immediate:!0}),H(async()=>{n.value.id&&await i.getRepos()}),(s,l)=>{const d=K,r=P,k=Q,C=re,w=ee,m=ae,g=te,z=le,A=oe,E=se,G=ne,O=ue,W=J;return c(),f(W,{class:"container"},{default:a(()=>[t(O,{ref_key:"formRef",ref:D,model:e.value,"label-col":{span:5},"wrapper-col":{span:16},rules:$.value,autocomplete:"off"},{default:a(()=>[t(r,{label:"Token",name:"token"},{default:a(()=>[t(d,{value:e.value.token,"onUpdate:value":l[0]||(l[0]=o=>e.value.token=o)},null,8,["value"])]),_:1}),t(r,{"wrapper-col":{offset:5,span:16}},{default:a(()=>[t(k,{onClick:B(h(N),["stop"]),type:"primary"},{default:a(()=>[pe]),_:1},8,["onClick"])]),_:1}),t(G,{style:{width:"100%",", min-height":"'100px'"},spinning:y.value,tip:"Loading..."},{default:a(()=>[h(n).id?(c(),M("div",fe,[t(r,{label:"\u7528\u6237\u540D",name:"login"},{default:a(()=>[t(d,{readonly:"",value:e.value.login,"onUpdate:value":l[1]||(l[1]=o=>e.value.login=o)},null,8,["value"])]),_:1}),t(r,{name:"selectedRepos",label:"\u9009\u62E9\u56FE\u5E8A\u4ED3\u5E93"},{default:a(()=>[t(w,{"show-search":"",value:e.value.selectedRepos,"onUpdate:value":l[2]||(l[2]=o=>e.value.selectedRepos=o)},{default:a(()=>[(c(!0),M(L,null,U(h(q),o=>(c(),f(C,{key:o.id,value:o.name},{default:a(()=>[u(_(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),t(r,{name:"selectedBranch",label:"\u9009\u62E9\u4ED3\u5E93\u5206\u652F"},{default:a(()=>[t(w,{"show-search":"",value:e.value.selectedBranch,"onUpdate:value":l[3]||(l[3]=o=>e.value.selectedBranch=o)},{default:a(()=>[(c(!0),M(L,null,U(h(F),o=>(c(),f(C,{key:o.name,value:o.name},{default:a(()=>[u(_(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e.value.selectedBranch?(c(),f(r,{key:0,name:"dirMode",label:"\u76EE\u5F55\u65B9\u5F0F"},{default:a(()=>[t(z,{onChange:I,value:e.value.dirMode,"onUpdate:value":l[4]||(l[4]=o=>e.value.dirMode=o)},{default:a(()=>[t(g,null,{title:a(()=>[me]),default:a(()=>[t(m,{value:1},{default:a(()=>[u(_(v.value[1]),1)]),_:1})]),_:1}),t(g,null,{title:a(()=>[ge]),default:a(()=>[t(m,{value:2},{default:a(()=>[u(_(v.value[2]),1)]),_:1})]),_:1}),t(g,null,{title:a(()=>[he]),default:a(()=>[t(m,{value:3},{default:a(()=>[u(_(v.value[3]),1)]),_:1})]),_:1}),t(g,null,{title:a(()=>[u("\u9009\u62E9"+_(e.value.selectedBranch)+"\u5206\u652F\u4E0B\u7684\u4E00\u4E2A\u76EE\u5F55",1)]),default:a(()=>[t(m,{value:4},{default:a(()=>[u(_(v.value[4]),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):Y("",!0),e.value.selectedBranch&&e.value.dirMode!==4?(c(),f(r,{key:1,name:"selectedDir",label:v.value[e.value.dirMode]},{default:a(()=>[t(d,{readonly:e.value.dirMode!==1,value:e.value.selectedDir,"onUpdate:value":l[5]||(l[5]=o=>e.value.selectedDir=o)},null,8,["readonly","value"])]),_:1},8,["label"])):(c(),f(r,{key:2,name:"selectedDirList",label:v.value[e.value.dirMode]},{default:a(()=>[t(A,{"change-on-select":"",options:R.value,"load-data":j,value:e.value.selectedDirList,"onUpdate:value":l[6]||(l[6]=o=>e.value.selectedDirList=o),placeholder:"\u8BF7\u9009\u62E9\u76EE\u5F55"},null,8,["options","value"])]),_:1},8,["label"])),t(r,{"wrapper-col":{offset:5,span:16}},{default:a(()=>[t(E,null,{default:a(()=>[t(k,{onClick:B(V,["stop"])},{default:a(()=>[ye]),_:1},8,["onClick"]),t(k,{onClick:B(S,["stop"]),type:"primary"},{default:a(()=>[De]),_:1},8,["onClick"])]),_:1})]),_:1})])):Y("",!0)]),_:1},8,["spinning"])]),_:1},8,["model","rules"])]),_:1})}}};var we=_e(ke,[["__scopeId","data-v-5bbd9554"]]);export{we as default};
