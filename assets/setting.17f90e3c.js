import{_ as K,u as Q,s as W,r as _,a as X,w as x,o as Z,b as c,c as m,d as a,C as ee,e as l,f as M,g as f,h as r,i as B,F as L,j as S,t as p,k as U,I as te,l as ae,B as le,m as oe,R as ne,n as se,p as ue,q as re,v as ie,S as de,x as ce,y as pe}from"./index.c1da32e6.js";/* empty css              */import{u as Y,a as ve,b as _e}from"./index.d16996fa.js";/* empty css              *//* empty css               */const me={key:0},fe={__name:"setting",setup(ge){const s=Q(),{config:u,repos:q,branches:T}=W(s),b=_([]),D=_(!1),k=_(null),F=X(),$=_({selectedRepo:[{required:!0,message:"\u8BF7\u9009\u62E9\u6587\u4EF6\u4E0A\u4F20\u7684\u4ED3\u5E93",trigger:"blur"}],selectedBranch:[{required:!0,message:"\u8BF7\u9009\u62E9\u4ED3\u5E93\u7684\u5206\u652F",trigger:"blur"}],selectedDir:[{required:!0,message:"\u8BF7\u8F93\u5165\u4E0A\u4F20\u6587\u4EF6\u7684\u76EE\u5F55",trigger:"blur",type:"string"}],selectedDirList:[{required:!0,message:"\u8BF7\u9009\u62E9\u4E0A\u4F20\u6587\u4EF6\u7684\u76EE\u5F55",trigger:"blur",type:"array"}]}),e=_({token:u.value.token,login:u.value.login,dirMode:u.value.dirMode,selectedDir:u.value.selectedDir,selectedRepo:u.value.selectedRepo,selectedBranch:u.value.selectedBranch,selectedDirList:u.value.selectedDirList}),v=_({1:"\u65B0\u5EFA\u76EE\u5F55",2:"\u6839\u76EE\u5F55",3:"\u81EA\u52A8\u76EE\u5F55",4:`\u9009\u62E9${u.value.selectedRepo}\u4ED3\u5E93\u76EE\u5F55`}),H=Y(async()=>{D.value=!0,await s.getUser(e.value.token),e.value.token=u.value.token,e.value.login=u.value.login,await s.getRepos(),D.value=!1},1e3,!1),N=Y(async n=>{n.target.scrollHeight-n.target.scrollTop-n.target.clientHeight<50&&s.repoHasMore&&(s.setRepoPage(s.repoPage+1),await s.getRepos())}),P=async()=>{try{await k.value.validate(),s.updateConfig({dirMode:e.value.dirMode,selectedDir:e.value.selectedDir,selectedRepo:e.value.selectedRepo,selectedBranch:e.value.selectedBranch,selectedDirList:e.value.selectedDirList}),F.push({path:"/upload"})}catch(n){console.log(n)}},I=()=>{k.value.resetFields(),s.logout()},V=()=>{e.value.dirMode===2?e.value.selectedDir="/":e.value.dirMode===3?e.value.selectedDir=ve(_e(),"YYYY/MM/DD").value:e.value.dirMode===1?e.value.selectedDir="xxx":e.value.dirMode===4&&(e.value.selectedDirList=[])},j=async n=>{const t=n[n.length-1];t.loading=!0;let d=await s.getBranchCatalogue({repo:e.value.selectedRepo,dir:e.value.selectedDirList.join("/"),query:{ref:e.value.selectedBranch}});t.loading=!1;let i=h(d);if(i.length===0){t.isLeaf=!0;return}t.children=i},h=n=>n.filter(t=>t.type==="dir").map(t=>{let d={};return d.label=t.name,d.value=t.name,d.isLeaf=!1,d});return x(()=>e.value.selectedBranch,async n=>{if(e.value.selectedDirList=[],n.trim()){let t=await s.getBranchCatalogue({repo:e.value.selectedRepo,dir:"",query:{ref:n}});b.value=h(t)}},{immediate:!0}),x(()=>e.value.selectedRepo,async n=>{n.trim()&&(u.value.selectedRepo!==n&&(e.value.selectedBranch=""),await s.getBranches(n))},{immediate:!0}),Z(async()=>{u.value.id&&await s.getRepos()}),(n,t)=>{const d=te,i=ae,R=le,w=pe,C=oe,g=ne,y=se,E=ue,O=re,z=ie,A=de,G=ce,J=ee;return c(),m(J,{class:"container"},{default:a(()=>[l(G,{ref_key:"formRef",ref:k,model:e.value,"label-col":{span:5},"wrapper-col":{span:16},rules:$.value,autocomplete:"off"},{default:a(()=>[l(i,{label:"Token",name:"token"},{default:a(()=>[l(d,{value:e.value.token,"onUpdate:value":t[0]||(t[0]=o=>e.value.token=o)},null,8,["value"])]),_:1}),l(i,{"wrapper-col":{offset:5,span:16}},{default:a(()=>[l(R,{onClick:M(f(H),["stop"]),type:"primary"},{default:a(()=>t[7]||(t[7]=[r("\u786E\u8BA4Token")])),_:1},8,["onClick"])]),_:1}),l(A,{style:{width:"100%",", min-height":"100px"},spinning:D.value,tip:"Loading..."},{default:a(()=>[f(u).id?(c(),B("div",me,[l(i,{label:"\u7528\u6237\u540D",name:"login"},{default:a(()=>[l(d,{readonly:"",value:e.value.login,"onUpdate:value":t[1]||(t[1]=o=>e.value.login=o)},null,8,["value"])]),_:1}),l(i,{name:"selectedRepo",label:"\u9009\u62E9\u56FE\u5E8A\u4ED3\u5E93"},{default:a(()=>[l(C,{onPopupScroll:f(N),"show-search":"",value:e.value.selectedRepo,"onUpdate:value":t[2]||(t[2]=o=>e.value.selectedRepo=o)},{default:a(()=>[(c(!0),B(L,null,S(f(q),o=>(c(),m(w,{key:o.id,value:o.name},{default:a(()=>[r(p(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["onPopupScroll","value"])]),_:1}),l(i,{name:"selectedBranch",label:"\u9009\u62E9\u4ED3\u5E93\u5206\u652F"},{default:a(()=>[l(C,{"show-search":"",value:e.value.selectedBranch,"onUpdate:value":t[3]||(t[3]=o=>e.value.selectedBranch=o)},{default:a(()=>[(c(!0),B(L,null,S(f(T),o=>(c(),m(w,{key:o.name,value:o.name},{default:a(()=>[r(p(o.name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),_:1}),e.value.selectedBranch?(c(),m(i,{key:0,name:"dirMode",label:"\u76EE\u5F55\u65B9\u5F0F"},{default:a(()=>[l(E,{onChange:V,value:e.value.dirMode,"onUpdate:value":t[4]||(t[4]=o=>e.value.dirMode=o)},{default:a(()=>[l(y,null,{title:a(()=>t[8]||(t[8]=[r("\u624B\u52A8\u521B\u5EFA\u4E00\u4E2A\u76EE\u5F55")])),default:a(()=>[l(g,{value:1},{default:a(()=>[r(p(v.value[1]),1)]),_:1})]),_:1}),l(y,null,{title:a(()=>t[9]||(t[9]=[r("\u5B58\u653E\u5728\u6839\u76EE\u5F55")])),default:a(()=>[l(g,{value:2},{default:a(()=>[r(p(v.value[2]),1)]),_:1})]),_:1}),l(y,null,{title:a(()=>t[10]||(t[10]=[r("\u6839\u636E\u65E5\u671F\u81EA\u52A8\u521B\u5EFAYYYYMMDD\u683C\u5F0F")])),default:a(()=>[l(g,{value:3},{default:a(()=>[r(p(v.value[3]),1)]),_:1})]),_:1}),l(y,null,{title:a(()=>[r("\u9009\u62E9"+p(e.value.selectedBranch)+"\u5206\u652F\u4E0B\u7684\u4E00\u4E2A\u76EE\u5F55",1)]),default:a(()=>[l(g,{value:4},{default:a(()=>[r(p(v.value[4]),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1})):U("",!0),e.value.selectedBranch&&e.value.dirMode!==4?(c(),m(i,{key:1,name:"selectedDir",label:v.value[e.value.dirMode]},{default:a(()=>[l(d,{readonly:e.value.dirMode!==1,value:e.value.selectedDir,"onUpdate:value":t[5]||(t[5]=o=>e.value.selectedDir=o)},null,8,["readonly","value"])]),_:1},8,["label"])):(c(),m(i,{key:2,name:"selectedDirList",label:v.value[e.value.dirMode]},{default:a(()=>[l(O,{"change-on-select":"",options:b.value,"load-data":j,value:e.value.selectedDirList,"onUpdate:value":t[6]||(t[6]=o=>e.value.selectedDirList=o),placeholder:"\u8BF7\u9009\u62E9\u76EE\u5F55"},null,8,["options","value"])]),_:1},8,["label"])),l(i,{"wrapper-col":{offset:5,span:16}},{default:a(()=>[l(z,null,{default:a(()=>[l(R,{onClick:M(I,["stop"])},{default:a(()=>t[11]||(t[11]=[r("\u91CD\u7F6E")])),_:1}),l(R,{onClick:M(P,["stop"]),type:"primary"},{default:a(()=>t[12]||(t[12]=[r("\u5B8C\u6210\u914D\u7F6E")])),_:1})]),_:1})]),_:1})])):U("",!0)]),_:1},8,["spinning"])]),_:1},8,["model","rules"])]),_:1})}}};var Be=K(fe,[["__scopeId","data-v-9c804684"]]);export{Be as default};
